<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go RESTful API(gRPC Client) + Python gRPC server | Road to architect</title><meta name=keywords content><meta name=description content="Go와 Python을 활용한 마이크로 서비스 아키텍처 활용 사례를 공유드립니다.
1. Introduction 얼마 전 런칭한 클라우드브릭의 Threat Intelligence API는 Go RESTful API (gRPC Client)와 Python gRPC Server (with pandas)로 만들어졌습니다.
본 글에서는 왜 Go RESTful API와 Python gRPC Server의 조합으로 서비스를 만들었는지를 공유하고자 합니다. :eyes: 비슷한 고민을 하시는 분들께 도움이 되었으면 좋겠습니다. :pray:
2. Design 2.1. Requirements Threat Intelligence API를 개발할 때, 아래와 같은 요구사항이 있었습니다.
가볍고 빨라야 한다. 서버의 리소스를 적게 사용하면서 사용자들의 요청을 빠르게 처리해야 합니다."><meta name=author content="Denver"><link rel=canonical href=https://aeharvlee.github.io/posts/2020-04-21-go-restful-api-with-python-grpc-server/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://aeharvlee.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://aeharvlee.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://aeharvlee.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://aeharvlee.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://aeharvlee.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Go RESTful API(gRPC Client) + Python gRPC server"><meta property="og:description" content="Go와 Python을 활용한 마이크로 서비스 아키텍처 활용 사례를 공유드립니다.
1. Introduction 얼마 전 런칭한 클라우드브릭의 Threat Intelligence API는 Go RESTful API (gRPC Client)와 Python gRPC Server (with pandas)로 만들어졌습니다.
본 글에서는 왜 Go RESTful API와 Python gRPC Server의 조합으로 서비스를 만들었는지를 공유하고자 합니다. :eyes: 비슷한 고민을 하시는 분들께 도움이 되었으면 좋겠습니다. :pray:
2. Design 2.1. Requirements Threat Intelligence API를 개발할 때, 아래와 같은 요구사항이 있었습니다.
가볍고 빨라야 한다. 서버의 리소스를 적게 사용하면서 사용자들의 요청을 빠르게 처리해야 합니다."><meta property="og:type" content="article"><meta property="og:url" content="https://aeharvlee.github.io/posts/2020-04-21-go-restful-api-with-python-grpc-server/"><meta property="og:image" content="https://aeharvlee.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-21T00:00:00+00:00"><meta property="og:site_name" content="Road to architect"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aeharvlee.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Go RESTful API(gRPC Client) + Python gRPC server"><meta name=twitter:description content="Go와 Python을 활용한 마이크로 서비스 아키텍처 활용 사례를 공유드립니다.
1. Introduction 얼마 전 런칭한 클라우드브릭의 Threat Intelligence API는 Go RESTful API (gRPC Client)와 Python gRPC Server (with pandas)로 만들어졌습니다.
본 글에서는 왜 Go RESTful API와 Python gRPC Server의 조합으로 서비스를 만들었는지를 공유하고자 합니다. :eyes: 비슷한 고민을 하시는 분들께 도움이 되었으면 좋겠습니다. :pray:
2. Design 2.1. Requirements Threat Intelligence API를 개발할 때, 아래와 같은 요구사항이 있었습니다.
가볍고 빨라야 한다. 서버의 리소스를 적게 사용하면서 사용자들의 요청을 빠르게 처리해야 합니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aeharvlee.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Go RESTful API(gRPC Client) + Python gRPC server","item":"https://aeharvlee.github.io/posts/2020-04-21-go-restful-api-with-python-grpc-server/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go RESTful API(gRPC Client) + Python gRPC server","name":"Go RESTful API(gRPC Client) \u002b Python gRPC server","description":"Go와 Python을 활용한 마이크로 서비스 아키텍처 활용 사례를 공유드립니다.\n1. Introduction 얼마 전 런칭한 클라우드브릭의 Threat Intelligence API는 Go RESTful API (gRPC Client)와 Python gRPC Server (with pandas)로 만들어졌습니다.\n본 글에서는 왜 Go RESTful API와 Python gRPC Server의 조합으로 서비스를 만들었는지를 공유하고자 합니다. :eyes: 비슷한 고민을 하시는 분들께 도움이 되었으면 좋겠습니다. :pray:\n2. Design 2.1. Requirements Threat Intelligence API를 개발할 때, 아래와 같은 요구사항이 있었습니다.\n가볍고 빨라야 한다. 서버의 리소스를 적게 사용하면서 사용자들의 요청을 빠르게 처리해야 합니다.","keywords":[],"articleBody":"Go와 Python을 활용한 마이크로 서비스 아키텍처 활용 사례를 공유드립니다.\n1. Introduction 얼마 전 런칭한 클라우드브릭의 Threat Intelligence API는 Go RESTful API (gRPC Client)와 Python gRPC Server (with pandas)로 만들어졌습니다.\n본 글에서는 왜 Go RESTful API와 Python gRPC Server의 조합으로 서비스를 만들었는지를 공유하고자 합니다. :eyes: 비슷한 고민을 하시는 분들께 도움이 되었으면 좋겠습니다. :pray:\n2. Design 2.1. Requirements Threat Intelligence API를 개발할 때, 아래와 같은 요구사항이 있었습니다.\n가볍고 빨라야 한다. 서버의 리소스를 적게 사용하면서 사용자들의 요청을 빠르게 처리해야 합니다. (Cost Efficiency) :money_with_wings: 실시간으로 위협 정보가 업데이트되는 클라우드브릭의 DB에서 클라이언트가 원하는 데이터를 빠르게 연산하여 즉각 전달해주어야 합니다. (Fast and flexible data analysis and manipulation) :open_hands: 1번의 요구사항을 충족하기 위해 저는 Go를 선택했습니다. 사용해보니 실제로 사용하는 리소스도 매우 적고 속도도 매우 빨랐습니다. 선택하길 정말 잘했다는 생각이 듭니다. :slightly_smiling_face:\nAPI를 설계할 때 사실상 제일 중요했던 2번 요구사항은 저의 발목을 잡았습니다. :poultry_leg:\nGo를 사용하고 싶었지만, Go만으로 2번 요구사항을 만족하는 것이 쉽지 않았기 때문입니다.\n클라우드브릭 데이터베이스에 매일 쌓이는 수많은 로우데이터에서 클라이언트의 요청에 맞는 데이터만 쏙쏙 추출해줘야하는데, 쿼리만으로는 이 문제를 해결하기가 어려웠습니다. (데이터 구조도 복잡하고 무엇보다 이 서비스만을 위해 만들어진 디비 스키마가 아니었습니다. 그래서 상당히 많은 조작을 필요로 했습니다.)\n복잡한 조건을 가진 쿼리를 많이 요청해야 했고 속도 또한 느렸습니다. 복잡한 조건의 쿼리를 많이 요청하면**, 디비에 부하가 심해지는 문제가 있었고** 무엇보다 속도가 느린 게 가장 치명적이었습니다. :crying_cat_face:\n결국 저는 2번 요구사항을 충족하기 위해 “Python의 pandas 라이브러리를 사용해서 문제를 해결하자!”라는 결론을 도출하게 되었습니다.\npandas 라이브러리를 사용하면 별도의 복잡한 조건 없이 SELECT 쿼리만으로 필요한 데이터를 가져와서 메모리에 로드하고, 원하는 결과를 빠르게 도출할 수 있습니다.\n복잡한 조건의 쿼리를 여러 번 디비서버에 요청할 필요가 없으니 디비 서버에 부하는 줄고, 더군다나 원하는 데이터를 추출하는 속도도 빠르다는 점에서 pandas는 정말 사랑스러운 라이브러리가 아닐 수 없습니다. :green_heart:\n2.2 Design Go와 Python을 함께 사용하기로 했으니 이제는 설계를 할 차례입니다. :muscle:\n저는 위와 같이 설계를 했고 각 컴포넌트(파란 박스)의 역할은 다음과 같습니다.\n2.2.1. Go RESTful API Echo Framework를 사용하였으며 Go Clean Architecture를 참조하여 프로젝트를 구성하였습니다.\nRole\n복잡한 연산을 요구하지 않는 간단한 쿼리를 필요로하는 클라이언트의 요청을 직접 처리합니다. 복잡한 연산을 요구하는, 즉 간단한 쿼리만으로 해결되지 않고 많은 양의 데이터 처리를 해야하는 작업은 Python gRPC 서버에게 요청합니다. (gRPC Client의 역할) 2.2.2. Python gRPC Server Role\nGo RESTful API로부터 받은 요청을 처리합니다. 많은 양의 데이터를 pandas 라이브러리로 효과적으로 빠르게 처리하고 grpcClient인 Go API에게 추출한 결과 데이터를 반환해줍니다. 이렇게 구성하여 저는 Go와 Python의 이점을 둘 다 누릴 수 있습니다.\n3. Implementation 3.1. Protocol Buffers (= protobuf) gRPC 서비스는 기본적으로 Protocol Buffers라는 특별한 자료구조를 사용하여 통신을 합니다.\ngRPC를 사용하길 정말 잘했다고 생각한 부분은, protobuf를 사용하기 위해 개발자가 따로 코딩을 할 필요가 없다는 점입니다. 👀\n.proto 파일을 정의하고 protoc(= Protocol Buffers Compiler)로 적절한 옵션을 주어 원하는 언어로 컴파일하면, probouf에 정의한 데이터를 주고 받을 수 있는 인터페이스 코드를 뚝딱 만들어줍니다. :clap::clap:\n제가 필요한 건, Go와 Python으로 protobuf를 다룰 수 있는 인터페이스 코드이니 아래와 같이 protoc를 사용해서 컴파일을 해줍니다.\n# If you installed protoc using Python... python -m grpc_tools.protoc --proto_path=./protos \\ --python_out=./gen/python \\ --grpc_python_out=./gen/python \\ ./protos/black_ipv4.proto # Or if you install just plain protoc protobuf.protoc --go_out=plugins=grpc:./gen/go/ protos/black_ipv4.proto 위와 같이 컴파일을 해주면 자신이 정의한 .proto를 다룰 수 있는 인터페이스 코드를 Python과 Go 언어로 생성할 수 있습니다. :fried_egg: 개발자가 할 일은 단지 생성된 코드를 import 해서 사용하기만 하면 됩니다. :clap::clap:\n3.2. Lets Use protobuf 구체적으로 gRPC 클라이언트인 Go RESTful API가 어떻게 Python gRPC 서버에게 연산을 요청하는지를 .proto 파일과 함께 살펴봅시다. :star:\n더불어 Python gRPC서버가 gRPC 클라이언트인 Go API에게 어떤 데이터를 제공해주는지도 함께 살펴보겠습니다.\nThreat Intelligence API에는 특정 블랙 아이피에 대한 평판정보(Reputation)를 조회할 수 있는 기능이 있습니다. 이 기능은 복잡한 데이터 연산을 요구하는 작업이여서 Python gRPC 서버가 처리하고 있습니다.\n27라인의 message ReputationRequest을 보면 클라이언트가 gRPC 서버에게 요청하는 요청 정보가 정의되어 있습니다.\n이 요청 정보는 Threat Intelligence API를 사용하는 사용자가 직접 옵션으로 주는 값입니다. Go RESTful API는 이 요청정보를 그대로 Python gRPC 서버에게 전달해주기 때문에 별도로 정의를 해둔 것입니다.\n35라인에 정의되어 있는 message Reputation은 gRPC 서버가 요청을 처리 한 뒤, gRPC 클라이언트에게 반환하는 자료구조입니다.\n3.3. gRPC Python gRPC가 처리하는 서비스에 대한 정의는 5라인에 service BlackIPv4Service로 정의되어 있습니다. (예시를 위해 한 가지 rpc만 정의해두었습니다.)\n매개변수로 ReputationRequest를 받고 있다는 걸 확인할 수 있습니다. 즉, Go gRPC client가 Python gRPC서버에게 요청할 때는 해당 자료형에 맞게 요청해야한다는 걸 알 수 있습니다.\n4 ~ 9라인에 그 내용이 기술되어 있습니다. 사용자들이 요청한 정보(rr *model.ReputationRequest)를 RPC 호출시 그대로 사용하고 있는 것을 확인하실 수 있습니다. :white_check_mark:\nblack_ipv4.proto의 27라인에 기재되어 있는 ReputationRequest의 포맷에 맞춰 gRPC 서버에게 요청하고 있다는 것을 보시면 됩니다. :slightly_smiling_face:\nPyhton gRPC 서버는 gRPC 클라이언트가 요청한 데이터를 request로 받고 get_reputation_by_ipv4(cnx, request) 를 통해 처리한 뒤 결과 reputation을 gRPC 클라이언트에게 리턴해줍니다. :tada:\ngRPC 클라이언트인 Go RESTful API 서버는 해당 데이터를 그대로 클라이언트에게 전달만 해주면 끝입니다. :smile:\n4. Summary 문제해결을 위해 다양한 언어가 필요하다면, 대부분 Microservice Architecture로 구현을 해야합니다.\ngRPC 통신은 Protocol Buffers 자료구조를 활용하여 Microservice들이 서로 통신하기 매우 편리하고 적합한 환경을 제공합니다.\n개발 생산성도 좋고 동작도 잘하니 비슷한 고민을 하고 계시다면 적극적으로 도입을 검토하셔도 좋을 것 같습니다.\n마이크로 서비스 아키텍처를 고민하신다면, Protocol Buffers를 사용하는 gRPC 통신으로 서비스를 구현해보시는 건 어떨까요?\n읽어주셔서 감사합니다!\n","wordCount":"794","inLanguage":"en","datePublished":"2020-04-21T00:00:00Z","dateModified":"2020-04-21T00:00:00Z","author":{"@type":"Person","name":"Denver"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://aeharvlee.github.io/posts/2020-04-21-go-restful-api-with-python-grpc-server/"},"publisher":{"@type":"Organization","name":"Road to architect","logo":{"@type":"ImageObject","url":"https://aeharvlee.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://aeharvlee.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://aeharvlee.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://aeharvlee.github.io/archives/ title=archives><span>archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aeharvlee.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://aeharvlee.github.io/posts/>Posts</a></div><h1 class=post-title>Go RESTful API(gRPC Client) + Python gRPC server</h1><div class=post-meta><span title='2020-04-21 00:00:00 +0000 UTC'>April 21, 2020</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;794 words&nbsp;·&nbsp;Denver&nbsp;|&nbsp;<a href=https://github.com/aeharvlee.github.io/content/posts/2020-04-21-go-restful-api-with-python-grpc-server.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-introduction>1. Introduction</a></li><li><a href=#2-design>2. Design</a><ul><li><a href=#21-requirements>2.1. Requirements</a></li><li><a href=#22-design>2.2 Design</a></li></ul></li><li><a href=#3-implementation>3. Implementation</a><ul><li><a href=#31-protocol-buffers--protobuf>3.1. Protocol Buffers (= protobuf)</a></li><li><a href=#32-lets-use-protobuf>3.2. Lets Use protobuf</a></li><li><a href=#33-grpc>3.3. gRPC</a></li></ul></li><li><a href=#4-summary>4. Summary</a></li></ul></nav></div></details></div><div class=post-content><p>Go와 Python을 활용한 마이크로 서비스 아키텍처 활용 사례를 공유드립니다.</p><p><img loading=lazy src=/images/2020-04-21-go-restful-api-with-python-grpc-server/0.png alt=gopher_looking_at_python></p><h2 id=1-introduction>1. Introduction<a hidden class=anchor aria-hidden=true href=#1-introduction>#</a></h2><p>얼마 전 런칭한 클라우드브릭의 Threat Intelligence API는 <strong>Go RESTful API</strong> (gRPC Client)와 <strong>Python gRPC Server</strong> (with pandas)로 만들어졌습니다.</p><p>본 글에서는 왜 <strong>Go RESTful API</strong>와 <strong>Python gRPC Server</strong>의 조합으로 서비스를 만들었는지를 공유하고자 합니다. :eyes:
비슷한 고민을 하시는 분들께 도움이 되었으면 좋겠습니다. :pray:</p><h2 id=2-design>2. Design<a hidden class=anchor aria-hidden=true href=#2-design>#</a></h2><h3 id=21-requirements>2.1. Requirements<a hidden class=anchor aria-hidden=true href=#21-requirements>#</a></h3><p>Threat Intelligence API를 개발할 때, 아래와 같은 요구사항이 있었습니다.</p><ol><li><strong>가볍고 빨라야 한다.</strong>
서버의 리소스를 적게 사용하면서 사용자들의 요청을 빠르게 처리해야 합니다. <strong>(Cost Efficiency)</strong> :money_with_wings:</li><li>실시간으로 위협 정보가 업데이트되는 클라우드브릭의 DB에서
<strong>클라이언트가 원하는 데이터를 빠르게 연산하여 즉각 전달</strong>해주어야 합니다.
<strong>(Fast and flexible data analysis and manipulation)</strong> :open_hands:</li></ol><p>1번의 요구사항을 충족하기 위해 저는 Go를 선택했습니다. 사용해보니 실제로 사용하는 리소스도 매우 적고 속도도 매우 빨랐습니다. 선택하길 정말 잘했다는 생각이 듭니다. :slightly_smiling_face:</p><p>API를 설계할 때 사실상 제일 중요했던 2<strong>번 요구사항</strong>은 저의 발목을 잡았습니다. :poultry_leg:</p><p>Go를 사용하고 싶었지만, Go만으로 2번 요구사항을 만족하는 것이 쉽지 않았기 때문입니다.</p><p>클라우드브릭 데이터베이스에 <strong>매일 쌓이는 수많은 로우데이터에서</strong> 클라이언트의 요청에 맞는 데이터만 쏙쏙 추출해줘야하는데, <strong>쿼리만으로는 이 문제를 해결하기가 어려웠습니다.</strong> (데이터 구조도 복잡하고 무엇보다 이 서비스만을 위해 만들어진 디비 스키마가 아니었습니다. 그래서 상당히 많은 조작을 필요로 했습니다.)</p><p>복잡한 조건을 가진 쿼리를 많이 요청해야 했고 속도 또한 느렸습니다.
복잡한 조건의 쿼리를 많이 요청하면**, 디비에 부하가 심해지는 문제가 있었고** 무엇보다 <strong>속도가 느린 게 가장 치명적이었습니다.</strong> :crying_cat_face:</p><p>결국 저는 2번 요구사항을 충족하기 위해 “Python의 <strong>pandas 라이브러리</strong>를 사용해서 문제를 해결하자!”라는 결론을 도출하게 되었습니다.</p><p>pandas 라이브러리를 사용하면 별도의 복잡한 조건 없이 <strong>SELECT 쿼리만으로 필요한 데이터를 가져와서 메모리에 로드하고, 원하는 결과를 빠르게 도출할 수 있습니다.</strong></p><p>복잡한 조건의 쿼리를 여러 번 디비서버에 요청할 필요가 없으니 <strong>디비 서버에 부하는 줄고,</strong> 더군다나 <strong>원하는 데이터를 추출하는 속도도 빠르다는 점</strong>에서 <strong>pandas</strong>는 정말 사랑스러운 라이브러리가 아닐 수 없습니다. :green_heart:</p><h3 id=22-design>2.2 Design<a hidden class=anchor aria-hidden=true href=#22-design>#</a></h3><p>Go와 Python을 함께 사용하기로 했으니 이제는 설계를 할 차례입니다. :muscle:</p><p><img loading=lazy src=/images/2020-04-21-go-restful-api-with-python-grpc-server/1.png alt=architecture_go_with_python></p><p>저는 위와 같이 설계를 했고 각 컴포넌트(파란 박스)의 역할은 다음과 같습니다.</p><h4 id=221-go-restful-api>2.2.1. Go RESTful API<a hidden class=anchor aria-hidden=true href=#221-go-restful-api>#</a></h4><blockquote><p>Echo Framework를 사용하였으며 <a href=https://github.com/bxcodec/go-clean-arch>Go Clean Architecture</a>를 참조하여 프로젝트를 구성하였습니다.</p></blockquote><p><strong>Role</strong></p><ul><li>복잡한 연산을 요구하지 않는 간단한 쿼리를 필요로하는 클라이언트의 요청을 직접 처리합니다.</li><li>복잡한 연산을 요구하는, 즉 간단한 쿼리만으로 해결되지 않고 많은 양의 데이터 처리를 해야하는 작업은 <strong>Python gRPC 서버</strong>에게 요청합니다.
<strong>(gRPC Client의 역할)</strong></li></ul><h4 id=222-python-grpc-server>2.2.2. Python gRPC Server<a hidden class=anchor aria-hidden=true href=#222-python-grpc-server>#</a></h4><p><strong>Role</strong></p><ul><li><strong>Go RESTful API</strong>로부터 받은 요청을 처리합니다.
많은 양의 데이터를 <strong>pandas</strong> 라이브러리로 효과적으로 빠르게 처리하고 grpcClient인 Go API에게 추출한 결과 데이터를 반환해줍니다.</li></ul><p>이렇게 구성하여 저는 Go와 Python의 이점을 둘 다 누릴 수 있습니다.</p><h2 id=3-implementation>3. Implementation<a hidden class=anchor aria-hidden=true href=#3-implementation>#</a></h2><h3 id=31-protocol-buffers--protobuf>3.1. Protocol Buffers (= protobuf)<a hidden class=anchor aria-hidden=true href=#31-protocol-buffers--protobuf>#</a></h3><p><strong>gRPC 서비스</strong>는 기본적으로 <a href=https://developers.google.com/protocol-buffers>Protocol Buffers</a>라는 특별한 자료구조를 사용하여 통신을 합니다.</p><p><strong>gRPC</strong>를 사용하길 정말 잘했다고 생각한 부분은, <strong>protobuf</strong>를 사용하기 위해 개발자가 따로 코딩을 할 필요가 없다는 점입니다. 👀</p><p><code>.proto</code> 파일을 정의하고 <strong>protoc</strong>(= Protocol Buffers Compiler)로 적절한 옵션을 주어 원하는 언어로 컴파일하면, <strong>probouf</strong>에 정의한 데이터를 주고 받을 수 있는 <strong>인터페이스 코드를 뚝딱 만들어줍니다.</strong> :clap::clap:</p><p>제가 필요한 건, Go와 Python으로 <strong>protobuf</strong>를 다룰 수 있는 <strong>인터페이스 코드</strong>이니 아래와 같이 protoc를 사용해서 컴파일을 해줍니다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># If you installed protoc using Python...</span>
</span></span><span class=line><span class=cl>python -m grpc_tools.protoc --proto_path<span class=o>=</span>./protos <span class=se>\ </span>
</span></span><span class=line><span class=cl>--python_out<span class=o>=</span>./gen/python <span class=se>\ </span>
</span></span><span class=line><span class=cl>--grpc_python_out<span class=o>=</span>./gen/python <span class=se>\ </span>
</span></span><span class=line><span class=cl>./protos/black_ipv4.proto
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Or if you install just plain protoc</span>
</span></span><span class=line><span class=cl>protobuf.protoc --go_out<span class=o>=</span><span class=nv>plugins</span><span class=o>=</span>grpc:./gen/go/ protos/black_ipv4.proto
</span></span></code></pre></div><p>위와 같이 컴파일을 해주면 자신이 정의한 <code>.proto</code>를 다룰 수 있는 인터페이스 코드를 Python과 Go 언어로 생성할 수 있습니다. :fried_egg:
개발자가 할 일은 단지 생성된 코드를 import 해서 사용하기만 하면 됩니다. :clap::clap:</p><h3 id=32-lets-use-protobuf>3.2. Lets Use protobuf<a hidden class=anchor aria-hidden=true href=#32-lets-use-protobuf>#</a></h3><p>구체적으로 gRPC 클라이언트인 <strong>Go RESTful API</strong>가 어떻게 <strong>Python gRPC 서버</strong>에게 연산을 요청하는지를 <code>.proto</code> 파일과 함께 살펴봅시다. :star:</p><p>더불어 <strong>Python gRPC서버</strong>가 gRPC 클라이언트인 Go API에게 어떤 데이터를 제공해주는지도 함께 살펴보겠습니다.</p><script type=application/javascript src=https://gist.github.com/aeharvlee/4e737aed3b245a17a3b95e815130a0e5.js></script><p>Threat Intelligence API에는 <strong>특정 블랙 아이피에 대한 평판정보(Reputation)를 조회할 수 있는 기능이 있습니다.</strong>
이 기능은 복잡한 데이터 연산을 요구하는 작업이여서 Python gRPC 서버가 처리하고 있습니다.</p><p>27라인의 <code>message ReputationRequest</code>을 보면 클라이언트가 gRPC 서버에게 요청하는 <strong>요청 정보</strong>가 정의되어 있습니다.</p><p>이 요청 정보는 Threat Intelligence API를 사용하는 사용자가 직접 옵션으로 주는 값입니다.
Go RESTful API는 이 요청정보를 그대로 Python gRPC 서버에게 전달해주기 때문에 별도로 정의를 해둔 것입니다.</p><p>35라인에 정의되어 있는 <code>message Reputation</code>은 gRPC 서버가 요청을 처리 한 뒤,
gRPC 클라이언트에게 반환하는 자료구조입니다.</p><h3 id=33-grpc>3.3. gRPC<a hidden class=anchor aria-hidden=true href=#33-grpc>#</a></h3><p>Python gRPC가 처리하는 서비스에 대한 정의는 5라인에 <code>service BlackIPv4Service</code>로 정의되어 있습니다. (예시를 위해 한 가지 rpc만 정의해두었습니다.)</p><p>매개변수로 <code>ReputationRequest</code>를 받고 있다는 걸 확인할 수 있습니다.
즉, Go gRPC client가 Python gRPC서버에게 요청할 때는
해당 자료형에 맞게 요청해야한다는 걸 알 수 있습니다.</p><script type=application/javascript src=https://gist.github.com/aeharvlee/8abc65f000b54cd0c0feff71370ea10a.js></script><p>4 ~ 9라인에 그 내용이 기술되어 있습니다. 사용자들이 요청한 정보(<code>rr *model.ReputationRequest</code>)를 RPC 호출시 그대로 사용하고 있는 것을 확인하실 수 있습니다. :white_check_mark:</p><p><code>black_ipv4.proto</code>의 27라인에 기재되어 있는 <code>ReputationRequest</code>의 포맷에 맞춰 gRPC 서버에게 요청하고 있다는 것을 보시면 됩니다. :slightly_smiling_face:</p><script type=application/javascript src=https://gist.github.com/aeharvlee/d08f58137153f75b301df2e2c3c41185.js></script><p><strong>Pyhton gRPC 서버</strong>는 gRPC 클라이언트가 요청한 데이터를 <code>request</code>로 받고 <code>get_reputation_by_ipv4(cnx, request)</code> 를 통해 처리한 뒤 결과 <code>reputation</code>을 <strong>gRPC 클라이언트</strong>에게 리턴해줍니다. :tada:</p><p>gRPC 클라이언트인 Go RESTful API 서버는 해당 데이터를 그대로 클라이언트에게 전달만 해주면 끝입니다. :smile:</p><h2 id=4-summary>4. Summary<a hidden class=anchor aria-hidden=true href=#4-summary>#</a></h2><p>문제해결을 위해 다양한 언어가 필요하다면, 대부분 Microservice Architecture로 구현을 해야합니다.</p><p><strong>gRPC 통신</strong>은 <strong>Protocol Buffers</strong> 자료구조를 활용하여 Microservice들이 서로 통신하기 매우 편리하고 적합한 환경을 제공합니다.</p><p>개발 생산성도 좋고 동작도 잘하니 비슷한 고민을 하고 계시다면 적극적으로 도입을 검토하셔도 좋을 것 같습니다.</p><p>마이크로 서비스 아키텍처를 고민하신다면, Protocol Buffers를 사용하는 gRPC 통신으로 서비스를 구현해보시는 건 어떨까요?</p><p>읽어주셔서 감사합니다!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://aeharvlee.github.io/posts/2020-05-19-renew-table-safely/><span class=title>« Prev</span><br><span>How to renew entire table's rows safely?</span></a>
<a class=next href=https://aeharvlee.github.io/posts/2020-04-01-huge-improvement-of-performance-in-pandas/><span class=title>Next »</span><br><span>Huge Improvement of performance in pandas</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Go RESTful API(gRPC Client) + Python gRPC server on twitter" href="https://twitter.com/intent/tweet/?text=Go%20RESTful%20API%28gRPC%20Client%29%20%2b%20Python%20gRPC%20server&url=https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Go RESTful API(gRPC Client) + Python gRPC server on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f&title=Go%20RESTful%20API%28gRPC%20Client%29%20%2b%20Python%20gRPC%20server&summary=Go%20RESTful%20API%28gRPC%20Client%29%20%2b%20Python%20gRPC%20server&source=https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Go RESTful API(gRPC Client) + Python gRPC server on reddit" href="https://reddit.com/submit?url=https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f&title=Go%20RESTful%20API%28gRPC%20Client%29%20%2b%20Python%20gRPC%20server"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Go RESTful API(gRPC Client) + Python gRPC server on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Go RESTful API(gRPC Client) + Python gRPC server on whatsapp" href="https://api.whatsapp.com/send?text=Go%20RESTful%20API%28gRPC%20Client%29%20%2b%20Python%20gRPC%20server%20-%20https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Go RESTful API(gRPC Client) + Python gRPC server on telegram" href="https://telegram.me/share/url?text=Go%20RESTful%20API%28gRPC%20Client%29%20%2b%20Python%20gRPC%20server&url=https%3a%2f%2faeharvlee.github.io%2fposts%2f2020-04-21-go-restful-api-with-python-grpc-server%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://aeharvlee.github.io/>Road to architect</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>